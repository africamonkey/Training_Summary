# Asia-Tsukuba 2017

## Practice Link

http://opentrains.snarknews.info/~ejudge/team.cgi?contest_id=006308

Username: guangzhou03

## 个人总结

### 王凯祺

今天还是太大意了，昨天打错下标，今天打错符号。G题 x1 * y2 - x2 * y1 第二个乘号打成减号调了很久……

最后那发所谓“绝杀”的K题，应该可以用一些技巧，让代码变得更短，可以更早AC。今晚看看标程怎么写的。

## 题解

### J题

考虑第二种条件，由于每种条件都是向前的，所以我们只需要计算每个点跟最前面的哪个点是字符相同的就可以了。

第二种条件是说 \[ l, r \] 区间跟 \[ l - k, r - k \] 区间相同，那么我们开一个线段树 \[ l, r \] 区间整个区间赋值为 k 。

如何查询 x 跟最前面哪个点是字符相同的？

考虑一种非常暴力的做法：每次拿 x 在线段树中找在该点的值是多少，假设为 k ，然后 x -= k 。

我们可以在线段树的查询上加一点优化，查询时假设现在在 [l, r] 区间，而 [l, r] 区间整个区间均为同一个值（最大值=最小值），那么 x 就可以直接跳到 
x - (x - l) / max * max 。

现在对于每个位置，都能找到与该位置本质相同的最前位置。

那么对于第一种条件，在最前位置修改该点的值；对于询问，询问最前位置的值。

复杂度：玄学？

### K题

考虑先构造出一棵树，多出 16 条边。我们将这 16 条边的 32 个点拿出来，构建虚树。

我们用 2 ^ 16 枚举每条边选或不选。

在虚树上，每条边维护一个布尔值。

若选择这条边，则该边这两个点在树上的路径全部异或 1 。

最终看看树上为 true 的边，加入我们枚举的边里面，判断是否为简单环即可。



