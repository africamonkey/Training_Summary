# The 2017 ACM - ICPC Asia Ho Chi Minh City Regional Contest

Date: 2018-02-27

## Practice Link

https://vjudge.net/contest/214026

## 个人总结

### 王凯祺

心好塞，J题想到了，写都写好了，最后半平面交求错了QAQ 其中一个下标打错了，然后样例又太水，没试出来，疯狂WA

debug 能力还需提高，我赛后还调了2个小时才调出来这个下标错。

D题和K题都很经典，我都没想到这个套路。

## 题解

### J题

记 sz(x) 表示 x 子树的节点数，
x1(x) 表示 x 子树的节点到 x 的距离和，
x2(x) 表示 x 子树的节点到 x 的平方和。
s(x) 表示 x 子树任意两节点的平方的总和（即答案）。

考虑 x 和 y 子树合并，推式子可得：

s(总) = s(x) + s(y) + sz(y) * x2(x) + sz(x) * x2(y) + 2 * sz(y) * x1(x) + 
2 * sz(x) * x1(y) + 2 * x1(x) * x1(y) + sz(x) * sz(y)

所以，我们对于两棵树的每个节点，都需要计算 x1, x2 ，即表示以该节点为根的 x1, x2 值。这可在 O(n) 时间内处理完毕。

考虑合并两棵树：

根据上式，我们可以把第一棵树变成 n 条直线插入凸包（k = 2 * x1(x), b = x2(x) * sz(y) + 2 * sz(y) * x1(x)），

然后用第二棵树在凸包里查询，找到最优解。

可以用单调队列来做。

时间复杂度O(n)。

### K题

按天数分块，每一块保留一个1-n的排列：原来教i号课室的老师在这一块结束后教j号课室。

若该块有修改，则整块更新。

询问时枚举所有块，复杂度为O(块数 + 块大小)。

### D题

考虑行数n较小的情况，暴力即可。

考虑行数n较大的情况：

维护一棵线段树，以行号为关键字。

每个节点保留一个m维向量a，其中a[i]表示从i进去，经过了[l, r]的转移，从哪里出来。

修改复杂度为m log n

询问复杂度为O(1)



